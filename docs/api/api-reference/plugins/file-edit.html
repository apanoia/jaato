<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Edit Plugin - jaato docs</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="../../index.html" class="header-logo">
      jaato <span>docs</span>
    </a>
    <nav class="header-nav">
      <a href="../../getting-started/quickstart.html">Quickstart</a>
      <a href="../index.html">API Reference</a>
      <a href="https://github.com/apanoia/jaato" target="_blank">GitHub</a>
      <div class="header-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search docs... (press /)">
      </div>
    </nav>
  </header>

  <!-- Layout -->
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Getting Started</div>
        <ul class="sidebar-nav">
          <li><a href="../../getting-started/quickstart.html">Quickstart</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Core Concepts</div>
        <ul class="sidebar-nav">
          <li><a href="../../core-concepts/client.html">Client</a></li>
          <li><a href="../../core-concepts/plugins.html">Plugins</a></li>
          <li><a href="../../core-concepts/tools.html">Tools</a></li>
          <li><a href="../../core-concepts/providers.html">Providers</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">API Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../index.html">Overview</a></li>
          <li><a href="../jaato-client.html">JaatoClient</a></li>
          <li><a href="../plugin-registry.html">PluginRegistry</a></li>
          <li><a href="../types.html">Types</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Provider Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../providers/index.html">Overview</a></li>
          <li><a href="../providers/google-genai.html">Google GenAI</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Plugin Reference</div>
        <ul class="sidebar-nav">
          <li><a href="index.html">Overview</a></li>
          <li><a href="cli.html">CLI</a></li>
          <li><a href="mcp.html">MCP</a></li>
          <li><a href="file-edit.html" class="active">File Edit</a></li>
          <li><a href="todo.html">Todo</a></li>
          <li><a href="web-search.html">Web Search</a></li>
          <li><a href="permission.html">Permission</a></li>
          <li><a href="session.html">Session</a></li>
          <li><a href="other.html">Other Plugins</a></li>
        </ul>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <!-- Overview -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h1>File Edit Plugin</h1>
          <p class="lead">
            Safe file operations with diff preview, automatic backups, and
            undo capability. Shows unified diffs in permission prompts for
            clear visibility of changes.
          </p>

          <table>
            <tbody>
              <tr>
                <td><strong>Name</strong></td>
                <td><code>file_edit</code></td>
              </tr>
              <tr>
                <td><strong>Type</strong></td>
                <td>Tool Plugin (Registry-managed)</td>
              </tr>
              <tr>
                <td><strong>Tools Provided</strong></td>
                <td><code>readFile</code>, <code>updateFile</code>, <code>writeNewFile</code>, <code>removeFile</code>, <code>undoFileChange</code></td>
              </tr>
              <tr>
                <td><strong>User Commands</strong></td>
                <td>None</td>
              </tr>
              <tr>
                <td><strong>Auto-approved</strong></td>
                <td><code>readFile</code>, <code>undoFileChange</code></td>
              </tr>
            </tbody>
          </table>

          <h2 id="features">Features</h2>
          <ul>
            <li><strong>Diff Preview</strong>: Shows unified diff in permission prompts</li>
            <li><strong>Automatic Backups</strong>: Creates backups before any modification</li>
            <li><strong>Undo Support</strong>: Restore any file from its most recent backup</li>
            <li><strong>Safe Defaults</strong>: Only read and undo are auto-approved</li>
            <li><strong>Gitignore Integration</strong>: Automatically adds <code>.jaato</code> to <code>.gitignore</code></li>
          </ul>
        </div>
        <div class="panel-code">
          <div class="code-label">Basic usage</div>
          <div class="code-block">
            <pre><code class="language-python">from shared import PluginRegistry

registry = PluginRegistry()
registry.discover()

# Expose file_edit plugin
registry.expose_tool('file_edit')

# Or with custom backup directory
registry.expose_tool('file_edit', config={
    'backup_dir': '/custom/backup/path'
})</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Model usage example</div>
          <div class="code-block">
            <pre><code class="language-python"># Read a file (auto-approved)
readFile(path="src/main.py")

# Update existing file (shows diff)
updateFile(
    path="src/main.py",
    new_content="import sys\n\ndef main():\n..."
)

# Create new file (shows content)
writeNewFile(
    path="src/utils.py",
    content="def helper():\n    return 42"
)

# Undo last change (auto-approved)
undoFileChange(path="src/main.py")</code></pre>
          </div>
        </div>
      </section>

      <!-- Configuration -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="configuration">Configuration Parameters</h2>

          <h3>backup_dir</h3>
          <p>
            Directory where backups are stored. Backups are organized by
            original file path within this directory.
          </p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>str</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>.jaato/backups</code></td></tr>
            </tbody>
          </table>

          <h3>Gitignore Integration</h3>
          <p>
            On initialization, the plugin automatically adds <code>.jaato</code>
            to your <code>.gitignore</code> if it exists and the entry is missing.
            This prevents backup files from being committed.
          </p>

          <div class="callout callout-info">
            <div class="callout-title">Backup Structure</div>
            Backups are stored with timestamps:
            <br><br>
            <code>.jaato/backups/src/main.py/2024-01-15_14-30-00.bak</code>
            <br><br>
            This allows multiple backups per file and easy manual recovery.
          </div>
        </div>
        <div class="panel-code">
          <div class="code-label">Backup directory structure</div>
          <div class="code-block">
            <pre><code class="language-text">.jaato/
  backups/
    src/
      main.py/
        2024-01-15_14-30-00.bak
        2024-01-15_15-45-22.bak
      utils.py/
        2024-01-15_14-35-10.bak
    config/
      settings.json/
        2024-01-14_09-00-00.bak</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Custom backup location</div>
          <div class="code-block">
            <pre><code class="language-python"># Use a shared backup location
registry.expose_tool('file_edit', config={
    'backup_dir': '/var/backups/jaato'
})

# Or per-project location
registry.expose_tool('file_edit', config={
    'backup_dir': '.backups'
})</code></pre>
          </div>
        </div>
      </section>

      <!-- Tool Reference -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="tools">Tool Reference</h2>

          <h3>readFile</h3>
          <p>
            Read the contents of a file. This is a safe, read-only operation
            and is auto-approved.
          </p>
          <table>
            <thead>
              <tr><th>Parameter</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>path</code></td><td><code>string</code></td><td>Path to file</td></tr>
            </tbody>
          </table>

          <h3>updateFile</h3>
          <p>
            Update an existing file with new content. Shows a unified diff
            for approval and creates a backup before modifying.
          </p>
          <table>
            <thead>
              <tr><th>Parameter</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>path</code></td><td><code>string</code></td><td>Path to existing file</td></tr>
              <tr><td><code>new_content</code></td><td><code>string</code></td><td>Complete new file content</td></tr>
            </tbody>
          </table>

          <h3>writeNewFile</h3>
          <p>
            Create a new file. Fails if the file already exists (use updateFile instead).
          </p>
          <table>
            <thead>
              <tr><th>Parameter</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>path</code></td><td><code>string</code></td><td>Path for new file</td></tr>
              <tr><td><code>content</code></td><td><code>string</code></td><td>File content to write</td></tr>
            </tbody>
          </table>

          <h3>removeFile</h3>
          <p>
            Delete a file. Creates a backup before deletion so it can be restored.
          </p>
          <table>
            <thead>
              <tr><th>Parameter</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>path</code></td><td><code>string</code></td><td>Path to file to delete</td></tr>
            </tbody>
          </table>

          <h3>undoFileChange</h3>
          <p>
            Restore a file from its most recent backup. Auto-approved since
            it's a recovery operation.
          </p>
          <table>
            <thead>
              <tr><th>Parameter</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>path</code></td><td><code>string</code></td><td>Path to file to restore</td></tr>
            </tbody>
          </table>
        </div>
        <div class="panel-code">
          <div class="code-label">readFile response</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "path": "src/main.py",
  "content": "import sys\n\ndef main():\n...",
  "size": 1234,
  "lines": 45
}</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">updateFile response</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "success": true,
  "path": "src/main.py",
  "size": 1456,
  "lines": 52,
  "backup": ".jaato/backups/src/main.py/2024-01-15_14-30-00.bak"
}</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">undoFileChange response</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "success": true,
  "path": "src/main.py",
  "restored_from": ".jaato/backups/src/main.py/2024-01-15_14-30-00.bak",
  "message": "File restored from backup"
}</code></pre>
          </div>
        </div>
      </section>

      <!-- Permission Display -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="permission-display">Permission Display</h2>
          <p>
            The file_edit plugin provides custom formatting for permission
            prompts, showing unified diffs for file modifications.
          </p>

          <h3>Update File Display</h3>
          <p>
            Shows a unified diff highlighting additions (green <code>+</code>)
            and deletions (red <code>-</code>).
          </p>

          <h3>New File Display</h3>
          <p>
            Shows all lines as additions since the file doesn't exist yet.
          </p>

          <h3>Delete File Display</h3>
          <p>
            Shows all lines as deletions, making it clear what will be removed.
          </p>

          <h3>Truncation</h3>
          <p>
            Large diffs are automatically truncated to prevent overwhelming
            the permission display. The summary indicates if truncation occurred.
          </p>
        </div>
        <div class="panel-code">
          <div class="code-label">Permission prompt example</div>
          <div class="code-block">
            <pre><code class="language-text">Tool: updateFile
Summary: Update file: src/main.py (+5/-2 lines)

--- src/main.py (original)
+++ src/main.py (modified)
@@ -1,5 +1,8 @@
 import sys
+import os
+from pathlib import Path

 def main():
-    print("hello")
+    print("Hello, World!")
+    return 0

 if __name__ == "__main__":
     main()

[y]es / [n]o / [a]lways / [never]</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">New file prompt</div>
          <div class="code-block">
            <pre><code class="language-text">Tool: writeNewFile
Summary: Create new file: src/utils.py (15 lines)

--- /dev/null
+++ src/utils.py
@@ -0,0 +1,15 @@
+"""Utility functions."""
+
+def helper():
+    """Return a helpful value."""
+    return 42
+
+def format_name(first, last):
+    """Format a full name."""
+    return f"{first} {last}"
...

[y]es / [n]o / [a]lways / [never]</code></pre>
          </div>
        </div>
      </section>

      <!-- Best Practices -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="best-practices">Best Practices</h2>

          <h3>Content Formatting</h3>
          <p>
            When using <code>updateFile</code> or <code>writeNewFile</code>,
            provide raw file content directly. Do not wrap in quotes or
            triple-quotes.
          </p>

          <h3>Use the Right Tool</h3>
          <ul>
            <li><code>updateFile</code>: For existing files only</li>
            <li><code>writeNewFile</code>: For new files only</li>
            <li>Using the wrong one returns a helpful error</li>
          </ul>

          <h3>Recovery Workflow</h3>
          <p>
            If a modification goes wrong:
          </p>
          <ol>
            <li>Use <code>undoFileChange(path)</code> to restore</li>
            <li>Review the original content with <code>readFile(path)</code></li>
            <li>Make the correct modification</li>
          </ol>
        </div>
        <div class="panel-code">
          <div class="code-label">Correct content format</div>
          <div class="code-block">
            <pre><code class="language-python"># CORRECT: Raw content
writeNewFile(
    path="example.py",
    content="import sys\n\ndef main():\n    pass"
)

# WRONG: Quoted content
writeNewFile(
    path="example.py",
    content='''"""
import sys

def main():
    pass
"""'''  # This writes the quotes too!
)</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Error messages</div>
          <div class="code-block">
            <pre><code class="language-json">// Using updateFile on non-existent file
{
  "error": "File not found: new.py. Use writeNewFile for new files."
}

// Using writeNewFile on existing file
{
  "error": "File already exists: main.py. Use updateFile to modify existing files."
}

// No backup available
{
  "error": "No backup found for: src/main.py"
}</code></pre>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>


  <script src="../../assets/js/docs.js"></script>
</body>
</html>
