<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Permission Plugin - jaato docs</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="../../index.html" class="header-logo">
      jaato <span>docs</span>
    </a>
    <nav class="header-nav">
      <a href="../../getting-started/quickstart.html">Quickstart</a>
      <a href="../index.html">API Reference</a>
      <a href="https://github.com/apanoia/jaato" target="_blank">GitHub</a>
      <div class="header-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search docs... (press /)">
      </div>
    </nav>
  </header>

  <!-- Layout -->
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Getting Started</div>
        <ul class="sidebar-nav">
          <li><a href="../../getting-started/quickstart.html">Quickstart</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Core Concepts</div>
        <ul class="sidebar-nav">
          <li><a href="../../core-concepts/client.html">Client</a></li>
          <li><a href="../../core-concepts/plugins.html">Plugins</a></li>
          <li><a href="../../core-concepts/tools.html">Tools</a></li>
          <li><a href="../../core-concepts/providers.html">Providers</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">API Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../index.html">Overview</a></li>
          <li><a href="../jaato-client.html">JaatoClient</a></li>
          <li><a href="../plugin-registry.html">PluginRegistry</a></li>
          <li><a href="../types.html">Types</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Plugin Reference</div>
        <ul class="sidebar-nav">
          <li><a href="index.html">Overview</a></li>
          <li><a href="cli.html">CLI</a></li>
          <li><a href="mcp.html">MCP</a></li>
          <li><a href="file-edit.html">File Edit</a></li>
          <li><a href="todo.html">Todo</a></li>
          <li><a href="web-search.html">Web Search</a></li>
          <li><a href="permission.html" class="active">Permission</a></li>
          <li><a href="session.html">Session</a></li>
          <li><a href="other.html">Other Plugins</a></li>
        </ul>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <!-- Overview -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h1>Permission Plugin</h1>
          <p class="lead">
            Control which tools the model can execute through policy-based
            access control with blacklist/whitelist rules and interactive approval.
          </p>

          <table>
            <tbody>
              <tr>
                <td><strong>Name</strong></td>
                <td><code>permission</code></td>
              </tr>
              <tr>
                <td><strong>Type</strong></td>
                <td>Client-configured Plugin</td>
              </tr>
              <tr>
                <td><strong>Tools Provided</strong></td>
                <td><code>askPermission</code></td>
              </tr>
              <tr>
                <td><strong>User Commands</strong></td>
                <td><code>permissions</code></td>
              </tr>
              <tr>
                <td><strong>Auto-approved</strong></td>
                <td><code>permissions</code></td>
              </tr>
            </tbody>
          </table>

          <h2 id="roles">Two Distinct Roles</h2>
          <p>
            The permission plugin serves two independent roles:
          </p>

          <ol>
            <li>
              <strong>Permission Enforcement (Middleware)</strong><br>
              Wraps tool execution to check permissions before any tool runs.
              Enabled via <code>configure_tools(permission_plugin=...)</code>
            </li>
            <li>
              <strong>Proactive Check Tool</strong><br>
              Exposes <code>askPermission</code> for the model to query permissions.
              Enabled via <code>expose_tool("permission")</code>
            </li>
          </ol>
        </div>
        <div class="panel-code">
          <div class="code-label">Basic usage</div>
          <div class="code-block">
            <pre><code class="language-python">from shared import PluginRegistry, PermissionPlugin

# Create permission plugin
permission = PermissionPlugin()
permission.initialize({
    'channel_type': 'console',
    'policy': {
        'default': 'ask',
        'whitelist_tools': ['readFile', 'web_search'],
        'blacklist_tools': ['rm', 'sudo'],
    }
})

# Configure on client for enforcement
client.configure_tools(
    registry,
    permission_plugin=permission,
)

# Optionally expose askPermission tool
registry.expose_tool('permission')</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Usage patterns</div>
          <div class="code-block">
            <pre><code class="language-python"># Enforcement only (no askPermission tool)
client.configure_tools(registry, permission_plugin=permission)

# Enforcement + proactive checks
client.configure_tools(registry, permission_plugin=permission)
registry.expose_tool('permission')

# No enforcement, proactive only (not recommended)
registry.expose_tool('permission')</code></pre>
          </div>
        </div>
      </section>

      <!-- Configuration -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="configuration">Configuration Parameters</h2>

          <h3>config_path</h3>
          <p>Path to permissions.json configuration file.</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>str</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>".jaato/permissions.json"</code></td></tr>
            </tbody>
          </table>

          <h3>channel_type</h3>
          <p>How to request approval from the user.</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>"console" | "webhook" | "file"</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>"console"</code></td></tr>
            </tbody>
          </table>

          <h3>channel_config</h3>
          <p>Configuration for the approval channel.</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>Dict[str, Any]</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>{}</code></td></tr>
            </tbody>
          </table>

          <h3>policy</h3>
          <p>Inline policy dict (overrides config file).</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>Dict[str, Any]</code></td></tr>
              <tr><td><strong>Default</strong></td><td>From config file</td></tr>
            </tbody>
          </table>
        </div>
        <div class="panel-code">
          <div class="code-label">Configuration example</div>
          <div class="code-block">
            <pre><code class="language-python">permission = PermissionPlugin()
permission.initialize({
    'channel_type': 'console',
    'policy': {
        'default': 'ask',
        'whitelist_tools': [
            'readFile',
            'web_search',
            'getPlanStatus',
        ],
        'blacklist_tools': [
            'rm -rf *',
            'sudo *',
        ],
        'whitelist_patterns': ['read*', 'get*'],
        'blacklist_patterns': ['*delete*', '*remove*'],
    }
})</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">permissions.json</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "channel_type": "console",
  "channel_timeout": 30,
  "default": "ask",
  "whitelist_tools": ["readFile", "web_search"],
  "blacklist_tools": ["rm", "sudo"],
  "whitelist_patterns": ["read*"],
  "blacklist_patterns": ["*delete*"]
}</code></pre>
          </div>
        </div>
      </section>

      <!-- Policy -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="policy">Policy Rules</h2>
          <p>
            Permission decisions are made in this order:
          </p>

          <ol>
            <li><strong>Blacklist check</strong>: If tool matches blacklist, deny</li>
            <li><strong>Whitelist check</strong>: If tool matches whitelist, allow</li>
            <li><strong>Default policy</strong>: Apply default (allow/deny/ask)</li>
          </ol>

          <h3>Default Policies</h3>
          <table>
            <thead>
              <tr><th>Policy</th><th>Behavior</th></tr>
            </thead>
            <tbody>
              <tr><td><code>allow</code></td><td>Auto-approve all unmatched tools</td></tr>
              <tr><td><code>deny</code></td><td>Auto-deny all unmatched tools</td></tr>
              <tr><td><code>ask</code></td><td>Prompt channel for each unmatched tool</td></tr>
            </tbody>
          </table>

          <h3>Pattern Matching</h3>
          <p>
            Whitelist/blacklist support glob patterns:
          </p>
          <ul>
            <li><code>*</code> matches any characters</li>
            <li><code>?</code> matches single character</li>
            <li><code>[seq]</code> matches characters in seq</li>
          </ul>
        </div>
        <div class="panel-code">
          <div class="code-label">Policy examples</div>
          <div class="code-block">
            <pre><code class="language-python"># Permissive: allow all, block dangerous
{
    'default': 'allow',
    'blacklist_patterns': ['*delete*', '*remove*', 'sudo*'],
}

# Restrictive: deny all, allow specific
{
    'default': 'deny',
    'whitelist_tools': ['readFile', 'web_search'],
}

# Interactive: ask for unknown
{
    'default': 'ask',
    'whitelist_tools': ['readFile'],  # Auto-approve reads
    'blacklist_tools': ['rm'],         # Auto-deny deletes
}</code></pre>
          </div>
        </div>
      </section>

      <!-- User Command -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="user-command">User Command</h2>

          <h3>permissions</h3>
          <p>
            Manage session permissions on-the-fly. Changes persist for the
            current session only.
          </p>

          <h4>Subcommands</h4>
          <table>
            <thead>
              <tr><th>Command</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>permissions show</code></td><td>Display current effective policy</td></tr>
              <tr><td><code>permissions check &lt;tool&gt;</code></td><td>Test what decision a tool would get</td></tr>
              <tr><td><code>permissions allow &lt;pattern&gt;</code></td><td>Add to session whitelist</td></tr>
              <tr><td><code>permissions deny &lt;pattern&gt;</code></td><td>Add to session blacklist</td></tr>
              <tr><td><code>permissions default &lt;policy&gt;</code></td><td>Set session default (allow/deny/ask)</td></tr>
              <tr><td><code>permissions clear</code></td><td>Reset all session modifications</td></tr>
            </tbody>
          </table>

          <div class="callout callout-info">
            <div class="callout-title">Session-Only Changes</div>
            Changes made via the <code>permissions</code> command only affect
            the current session. They don't modify the config file.
          </div>
        </div>
        <div class="panel-code">
          <div class="code-label">User command examples</div>
          <div class="code-block">
            <pre><code class="language-text">> permissions show

Current Policy:
  Default: ask
  Whitelist: readFile, web_search
  Blacklist: rm, sudo

> permissions allow cli_based_tool

Added 'cli_based_tool' to session whitelist

> permissions default allow

Session default set to 'allow'

> permissions check updateFile

Tool: updateFile
Decision: ASK (no rule match, default policy)

> permissions clear

Session modifications cleared</code></pre>
          </div>
        </div>
      </section>

      <!-- Approval Flow -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="approval-flow">Interactive Approval</h2>
          <p>
            When a tool requires approval (policy is "ask" or no rule match),
            the channel prompts the user:
          </p>

          <h3>Console Channel</h3>
          <p>
            Shows tool details and waits for keyboard input:
          </p>
          <ul>
            <li><code>[y]es</code>: Allow this execution</li>
            <li><code>[n]o</code>: Deny this execution</li>
            <li><code>[a]lways</code>: Allow and add to session whitelist</li>
            <li><code>[never]</code>: Deny and add to session blacklist</li>
          </ul>

          <h3>Custom Display</h3>
          <p>
            Plugins can provide custom formatting for their tools via
            <code>format_permission_request()</code>. For example, file_edit
            shows unified diffs for file modifications.
          </p>
        </div>
        <div class="panel-code">
          <div class="code-label">Approval prompt example</div>
          <div class="code-block">
            <pre><code class="language-text">Tool: cli_based_tool
Intent: List files to find config

Arguments:
{
  "command": "ls -la /etc"
}

[y]es / [n]o / [a]lways / [never]: _</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">With custom display (file_edit)</div>
          <div class="code-block">
            <pre><code class="language-text">Tool: updateFile
Summary: Update file: src/main.py (+5/-2 lines)

--- src/main.py (original)
+++ src/main.py (modified)
@@ -1,5 +1,8 @@
 import sys
+import os
+from pathlib import Path

 def main():
-    print("hello")
+    print("Hello, World!")

[y]es / [n]o / [a]lways / [never]: _</code></pre>
          </div>
        </div>
      </section>

      <!-- askPermission Tool -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="ask-permission">askPermission Tool</h2>
          <p>
            Allows the model to proactively check if a tool is allowed before
            attempting execution.
          </p>

          <h3>Parameters</h3>
          <table>
            <thead>
              <tr><th>Name</th><th>Type</th><th>Required</th></tr>
            </thead>
            <tbody>
              <tr><td><code>tool_name</code></td><td><code>string</code></td><td>Yes</td></tr>
              <tr><td><code>intent</code></td><td><code>string</code></td><td>Yes</td></tr>
              <tr><td><code>arguments</code></td><td><code>object</code></td><td>No</td></tr>
            </tbody>
          </table>

          <h3>Response</h3>
          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>allowed</code></td><td><code>bool</code></td><td>Whether tool is permitted</td></tr>
              <tr><td><code>reason</code></td><td><code>string</code></td><td>Explanation of decision</td></tr>
              <tr><td><code>rule_matched</code></td><td><code>string</code></td><td>Which rule applied</td></tr>
            </tbody>
          </table>
        </div>
        <div class="panel-code">
          <div class="code-label">Model using askPermission</div>
          <div class="code-block">
            <pre><code class="language-python"># Model checks before executing
askPermission(
    tool_name="cli_based_tool",
    intent="Delete temporary files to free disk space",
    arguments={"command": "rm -rf /tmp/cache/*"}
)

# Response
{
  "allowed": false,
  "reason": "Tool matches blacklist pattern",
  "rule_matched": "rm*"
}</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Allowed response</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "allowed": true,
  "reason": "Tool is whitelisted",
  "rule_matched": "readFile"
}</code></pre>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>


  <script src="../../assets/js/docs.js"></script>
</body>
</html>
