<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MCP Plugin - jaato docs</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="../../index.html" class="header-logo">
      jaato <span>docs</span>
    </a>
    <nav class="header-nav">
      <a href="../../getting-started/quickstart.html">Quickstart</a>
      <a href="../index.html">API Reference</a>
      <a href="https://github.com/apanoia/jaato" target="_blank">GitHub</a>
      <div class="header-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search docs... (press /)">
      </div>
    </nav>
  </header>

  <!-- Layout -->
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Getting Started</div>
        <ul class="sidebar-nav">
          <li><a href="../../getting-started/quickstart.html">Quickstart</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Core Concepts</div>
        <ul class="sidebar-nav">
          <li><a href="../../core-concepts/client.html">Client</a></li>
          <li><a href="../../core-concepts/plugins.html">Plugins</a></li>
          <li><a href="../../core-concepts/tools.html">Tools</a></li>
          <li><a href="../../core-concepts/providers.html">Providers</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">API Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../index.html">Overview</a></li>
          <li><a href="../jaato-client.html">JaatoClient</a></li>
          <li><a href="../plugin-registry.html">PluginRegistry</a></li>
          <li><a href="../types.html">Types</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Plugin Reference</div>
        <ul class="sidebar-nav">
          <li><a href="index.html">Overview</a></li>
          <li><a href="cli.html">CLI</a></li>
          <li><a href="mcp.html" class="active">MCP</a></li>
          <li><a href="file-edit.html">File Edit</a></li>
          <li><a href="todo.html">Todo</a></li>
          <li><a href="web-search.html">Web Search</a></li>
          <li><a href="permission.html">Permission</a></li>
          <li><a href="session.html">Session</a></li>
          <li><a href="other.html">Other Plugins</a></li>
        </ul>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <!-- Overview -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h1>MCP Plugin</h1>
          <p class="lead">
            Bridge to Model Context Protocol (MCP) servers, enabling the model to
            interact with external services like Atlassian, GitHub, Slack, and more.
          </p>

          <table>
            <tbody>
              <tr>
                <td><strong>Name</strong></td>
                <td><code>mcp</code></td>
              </tr>
              <tr>
                <td><strong>Type</strong></td>
                <td>Tool Plugin (Registry-managed)</td>
              </tr>
              <tr>
                <td><strong>Tools Provided</strong></td>
                <td>Dynamic (discovered from MCP servers)</td>
              </tr>
              <tr>
                <td><strong>User Commands</strong></td>
                <td>None</td>
              </tr>
              <tr>
                <td><strong>Auto-approved</strong></td>
                <td>None (requires permission)</td>
              </tr>
            </tbody>
          </table>

          <h2 id="features">Features</h2>
          <ul>
            <li><strong>Dynamic Tool Discovery</strong>: Automatically discovers tools from connected MCP servers</li>
            <li><strong>Multi-Server Support</strong>: Connect to multiple MCP servers simultaneously</li>
            <li><strong>Background Connection</strong>: Runs async MCP protocol in background thread</li>
            <li><strong>Environment Variable Expansion</strong>: Support for <code>${VAR}</code> syntax in config</li>
            <li><strong>Vertex AI Compatible</strong>: Cleans schemas for Vertex AI compatibility</li>
          </ul>

          <h2 id="how-it-works">How It Works</h2>
          <ol>
            <li>Plugin reads <code>.mcp.json</code> configuration</li>
            <li>Spawns MCP server processes (stdio transport)</li>
            <li>Discovers available tools from each server</li>
            <li>Exposes discovered tools to the AI model</li>
            <li>Routes tool calls to the appropriate MCP server</li>
          </ol>
        </div>
        <div class="panel-code">
          <div class="code-label">Basic usage</div>
          <div class="code-block">
            <pre><code class="language-python">from shared import PluginRegistry

registry = PluginRegistry()
registry.discover()

# Expose MCP plugin
# (reads .mcp.json from cwd or home directory)
registry.expose_tool('mcp')

# Check discovered tools
schemas = registry.get_exposed_tool_schemas()
for schema in schemas:
    print(f"- {schema.name}: {schema.description}")</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Discovered tools example</div>
          <div class="code-block">
            <pre><code class="language-text">From 'Atlassian' server:
  - confluence_search: Search Confluence pages
  - jira_get_issue: Get JIRA issue details
  - jira_create_issue: Create a new JIRA issue

From 'github' server:
  - github_search_repos: Search GitHub repositories
  - github_get_file: Get file contents from repo</code></pre>
          </div>
        </div>
      </section>

      <!-- Configuration -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="configuration">Configuration</h2>
          <p>
            MCP servers are configured via <code>.mcp.json</code>. The plugin searches
            for this file in:
          </p>
          <ol>
            <li><code>./.mcp.json</code> (current working directory)</li>
            <li><code>~/.mcp.json</code> (home directory)</li>
          </ol>

          <h3>Server Specification</h3>
          <table>
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>type</code></td>
                <td><code>string</code></td>
                <td>Transport type (currently only <code>"stdio"</code>)</td>
              </tr>
              <tr>
                <td><code>command</code></td>
                <td><code>string</code></td>
                <td>Executable to spawn</td>
              </tr>
              <tr>
                <td><code>args</code></td>
                <td><code>string[]</code></td>
                <td>Command line arguments</td>
              </tr>
              <tr>
                <td><code>env</code></td>
                <td><code>object</code></td>
                <td>Environment variables</td>
              </tr>
            </tbody>
          </table>

          <h3>Environment Variable Expansion</h3>
          <p>
            Environment variables in the config can reference system env vars
            using the <code>${VAR_NAME}</code> syntax.
          </p>
        </div>
        <div class="panel-code">
          <div class="code-label">.mcp.json example</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "mcpServers": {
    "Atlassian": {
      "type": "stdio",
      "command": "mcp-atlassian",
      "args": [],
      "env": {
        "ATLASSIAN_URL": "${ATLASSIAN_URL}",
        "ATLASSIAN_USER": "${ATLASSIAN_USER}",
        "ATLASSIAN_TOKEN": "${ATLASSIAN_TOKEN}"
      }
    },
    "github": {
      "type": "stdio",
      "command": "mcp-github",
      "args": ["--org", "my-org"],
      "env": {
        "GITHUB_TOKEN": "${GITHUB_TOKEN}"
      }
    },
    "slack": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-slack"],
      "env": {
        "SLACK_BOT_TOKEN": "${SLACK_BOT_TOKEN}"
      }
    }
  }
}</code></pre>
          </div>
        </div>
      </section>

      <!-- Tool Execution -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="tool-execution">Tool Execution</h2>
          <p>
            When the model invokes an MCP tool, the plugin:
          </p>
          <ol>
            <li>Looks up which server provides the tool</li>
            <li>Routes the call to that server's connection</li>
            <li>Waits for the response (30 second timeout)</li>
            <li>Returns the result to the model</li>
          </ol>

          <h3>Return Value</h3>
          <table>
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>result.tool</code></td>
                <td><code>string</code></td>
                <td>Name of the tool that was called</td>
              </tr>
              <tr>
                <td><code>result.isError</code></td>
                <td><code>bool</code></td>
                <td>Whether the MCP call resulted in error</td>
              </tr>
              <tr>
                <td><code>result.content</code></td>
                <td><code>string[]</code></td>
                <td>Text content from the response</td>
              </tr>
              <tr>
                <td><code>result.structured</code></td>
                <td><code>object</code></td>
                <td>Structured content if provided</td>
              </tr>
              <tr>
                <td><code>error</code></td>
                <td><code>string</code></td>
                <td>Error message if call failed</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="panel-code">
          <div class="code-label">Example tool call</div>
          <div class="code-block">
            <pre><code class="language-python"># Model invokes an MCP tool:
# jira_get_issue(issue_key="PROJ-123")

# Plugin returns:
{
  "result": {
    "tool": "jira_get_issue",
    "isError": false,
    "content": [
      "Issue: PROJ-123\nTitle: Fix login bug\n..."
    ],
    "structured": {
      "key": "PROJ-123",
      "summary": "Fix login bug",
      "status": "In Progress",
      "assignee": "john.doe"
    }
  }
}

# On error:
{
  "error": "Tool 'unknown_tool' not found on any MCP server"
}</code></pre>
          </div>
        </div>
      </section>

      <!-- Common MCP Servers -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="common-servers">Common MCP Servers</h2>
          <p>
            Here are some popular MCP servers that work with this plugin:
          </p>

          <table>
            <thead>
              <tr>
                <th>Server</th>
                <th>Package</th>
                <th>Capabilities</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Atlassian</td>
                <td><code>mcp-atlassian</code></td>
                <td>JIRA, Confluence</td>
              </tr>
              <tr>
                <td>GitHub</td>
                <td><code>@anthropic/mcp-github</code></td>
                <td>Repos, Issues, PRs</td>
              </tr>
              <tr>
                <td>Slack</td>
                <td><code>@anthropic/mcp-slack</code></td>
                <td>Messages, Channels</td>
              </tr>
              <tr>
                <td>Filesystem</td>
                <td><code>@anthropic/mcp-filesystem</code></td>
                <td>File operations</td>
              </tr>
              <tr>
                <td>PostgreSQL</td>
                <td><code>mcp-postgres</code></td>
                <td>Database queries</td>
              </tr>
            </tbody>
          </table>

          <div class="callout callout-info">
            <div class="callout-title">Installing MCP Servers</div>
            MCP servers are typically installed via npm or pip:
            <br><br>
            <code>npm install -g @anthropic/mcp-github</code>
            <br>
            <code>pip install mcp-atlassian</code>
          </div>
        </div>
        <div class="panel-code">
          <div class="code-label">Full configuration example</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "mcpServers": {
    "Atlassian": {
      "type": "stdio",
      "command": "mcp-atlassian",
      "env": {
        "ATLASSIAN_URL": "${ATLASSIAN_URL}",
        "ATLASSIAN_USER": "${ATLASSIAN_USER}",
        "ATLASSIAN_TOKEN": "${ATLASSIAN_TOKEN}"
      }
    },
    "github": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-github"],
      "env": {
        "GITHUB_TOKEN": "${GITHUB_TOKEN}"
      }
    },
    "filesystem": {
      "type": "stdio",
      "command": "npx",
      "args": [
        "-y", "@anthropic/mcp-filesystem",
        "--allow-read", "/home/user/projects",
        "--allow-write", "/home/user/projects"
      ]
    }
  }
}</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Required environment variables</div>
          <div class="code-block">
            <pre><code class="language-bash"># Atlassian
export ATLASSIAN_URL="https://company.atlassian.net"
export ATLASSIAN_USER="user@company.com"
export ATLASSIAN_TOKEN="your-api-token"

# GitHub
export GITHUB_TOKEN="ghp_xxxxxxxxxxxx"

# Slack
export SLACK_BOT_TOKEN="xoxb-xxxxxxxxxxxx"</code></pre>
          </div>
        </div>
      </section>

      <!-- Troubleshooting -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="troubleshooting">Troubleshooting</h2>

          <h3>No tools discovered</h3>
          <ul>
            <li>Verify <code>.mcp.json</code> exists and is valid JSON</li>
            <li>Check that MCP server executables are installed and in PATH</li>
            <li>Look for error messages in stderr during initialization</li>
          </ul>

          <h3>Connection errors</h3>
          <ul>
            <li>Verify environment variables are set correctly</li>
            <li>Check MCP server's own logs for auth/connection issues</li>
            <li>Try running the MCP server command directly to test</li>
          </ul>

          <h3>Tool call timeout</h3>
          <ul>
            <li>Default timeout is 30 seconds</li>
            <li>Some MCP operations may take longer</li>
            <li>Check MCP server for slow operations or network issues</li>
          </ul>

          <h3>Schema validation errors</h3>
          <p>
            The plugin automatically removes unsupported JSON Schema fields
            (<code>$schema</code>, <code>$ref</code>, <code>$defs</code>, etc.)
            for Vertex AI compatibility. If you see schema errors, the MCP
            server may be using unsupported schema features.
          </p>
        </div>
        <div class="panel-code">
          <div class="code-label">Testing MCP server manually</div>
          <div class="code-block">
            <pre><code class="language-bash"># Test that the MCP server starts correctly
mcp-atlassian

# Should output JSON-RPC messages like:
# {"jsonrpc":"2.0","method":"...","params":...}

# If you see errors, check environment:
env | grep ATLASSIAN

# Check the executable is in PATH:
which mcp-atlassian</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Debug output</div>
          <div class="code-block">
            <pre><code class="language-text"># The plugin logs connection issues to stderr:

[MCPToolPlugin] Connection error for Atlassian:
  Connection refused - is the server running?

[MCPToolPlugin] Error creating schema for tool_name:
  Unsupported schema format

[Filtered non-JSONRPC]: npm WARN deprecated...
  (harmless - filtering npm noise)</code></pre>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>


  <script src="../../assets/js/docs.js"></script>
</body>
</html>
